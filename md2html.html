<!DOCTYPE html><html lang="en"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown to Static HTML Converter</title>
    
    <!-- CSS Libraries -->
    <!-- CodeMirror (Editor) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css">
    <!-- KaTeX (Math) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css">
    <!-- Highlight.js (Code Syntax) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">

    <style>
        :root {
            --bg-color: #1e1e1e;
            --header-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --border-color: #444;
            --accent-color: #007acc;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        header {
            background-color: var(--header-bg);
            padding: 0.5rem 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 50px;
        }

        h1 { font-size: 1.2rem; font-weight: 600; }

        .btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        .btn:hover { background-color: #005fa3; }

        /* Main Layout */
        main {
            display: flex;
            flex: 1;
            height: calc(100vh - 50px);
        }

        /* Editor Pane */
        #editor-pane {
            flex: 1;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .CodeMirror {
            height: 100% !important;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
        }

        /* Preview Pane */
        #preview-pane {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background-color: #ffffff;
            color: #24292e; /* Github markdown color */
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            main { flex-direction: column; }
            #editor-pane { border-right: none; border-bottom: 1px solid var(--border-color); height: 50%; }
            #preview-pane { height: 50%; padding: 1rem; }
        }

        /* Markdown Content Styles (GitHub-like) */
        .markdown-body {
            font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif;
            font-size: 16px;
            line-height: 1.5;
            word-wrap: break-word;
        }
        .markdown-body h1, .markdown-body h2 { border-bottom: 1px solid #eaecef; padding-bottom: .3em; }
        .markdown-body blockquote { border-left: .25em solid #dfe2e5; color: #6a737d; padding: 0 1em; }
        .markdown-body pre { background-color: #f6f8fa; padding: 16px; border-radius: 6px; overflow: auto; }
        .markdown-body code { font-family: SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace; background-color: rgba(27,31,35,.05); padding: .2em .4em; border-radius: 3px; }
        .markdown-body pre code { background: none; padding: 0; }
        .markdown-body table { border-collapse: collapse; width: 100%; margin-bottom: 1rem; }
        .markdown-body table th, .markdown-body table td { border: 1px solid #dfe2e5; padding: 6px 13px; }
        .markdown-body table tr:nth-child(2n) { background-color: #f6f8fa; }
        .markdown-body img { max-width: 100%; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        
        /* Mermaid alignment */
        .mermaid { display: flex; justify-content: center; margin: 1rem 0; }
    </style>
<script src="https://puc.poecdn.net/authenticated_preview_page/syncedState.3f7572448765332f3047.js"></script></head>
<body>

<header>
    <h1>MD to Static HTML</h1>
    <button class="btn" onclick="exportHtml()">Export Static HTML</button>
</header>

<main>
    <div id="editor-pane">
        <textarea id="code-editor"></textarea>
    </div>
    <div id="preview-pane" class="markdown-body">
        <!-- Rendered content goes here -->
    </div>
</main>

<!-- JS Libraries -->
<!-- Markdown Parser -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.1/markdown-it.min.js"></script>
<!-- CodeMirror -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/markdown/markdown.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
<!-- KaTeX -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.js"></script>
<!-- Mermaid -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
<!-- Highlight.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

<script>
    // 1. Initialization
    const md = window.markdownit({
        html: true,
        linkify: true,
        typographer: true,
        highlight: function (str, lang) {
            if (lang && hljs.getLanguage(lang)) {
                try {
                    return hljs.highlight(str, { language: lang }).value;
                } catch (__) {}
            }
            return ''; // use external default escaping
        }
    });

    // Initialize Mermaid
    mermaid.initialize({ startOnLoad: false, theme: 'default' });

    // Initialize CodeMirror Editor
    const editor = CodeMirror.fromTextArea(document.getElementById("code-editor"), {
        mode: "markdown",
        theme: "dracula",
        lineNumbers: true,
        lineWrapping: true,
        indentUnit: 4
    });

    // Set default content
    const defaultContent = `# Welcome to the Converter

## Features
1. **Syntax Highlighting**:
\`\`\`javascript
function hello() {
  console.log("Hello World");
}
\`\`\`

2. **LaTeX Math**:
The quadratic formula is $$x = {-b \\pm \\sqrt{b^2-4ac} \\over 2a}$$

3. **Mermaid Graphs**:
\`\`\`mermaid
graph TD;
    A[User Input] --> B{Markdown?};
    B -- Yes --> C[Render HTML];
    B -- No --> D[Plain Text];
    C --> E[Export Static HTML];
\`\`\`

4. **Tables**:

| Feature | Status |
| :--- | :--- |
| Responsive | ✅ |
| Drag & Drop | ✅ |
| Export | ✅ |

Try dragging an image here!
`;
    editor.setValue(defaultContent);

    // 2. Logic for Rendering
    const previewPane = document.getElementById('preview-pane');
    let timer;

    function render() {
        const rawMarkdown = editor.getValue();
        
        // Step A: Pre-process LaTeX (Simple regex approach for $$...$$ and $...$)
        // Note: A full tokenizer is better for production, but this works for general use.
        let processedMarkdown = rawMarkdown.replace(/\$\$([\s\S]+?)\$\$/g, (match, tex) => {
            try {
                return katex.renderToString(tex, { displayMode: true });
            } catch (e) { return match; }
        });
        
        processedMarkdown = processedMarkdown.replace(/\$([^$]+?)\$/g, (match, tex) => {
            try {
                return katex.renderToString(tex, { displayMode: false });
            } catch (e) { return match; }
        });

        // Step B: Custom Fence for Mermaid
        // We intercept the 'mermaid' language block and return a div that mermaid.js will target later
        const originalFence = md.renderer.rules.fence;
        md.renderer.rules.fence = function (tokens, idx, options, env, self) {
            const token = tokens[idx];
            const info = token.info.trim();
            if (info === 'mermaid') {
                return `<div class="mermaid">${token.content}</div>`;
            }
            // Pass others to default highlighter
            return originalFence ? originalFence(tokens, idx, options, env, self) : '';
        };

        // Step C: Render Markdown to HTML
        previewPane.innerHTML = md.render(processedMarkdown);

        // Step D: Render Mermaid Diagrams
        // Mermaid looks for .mermaid classes and turns text into SVG
        mermaid.run({
            nodes: previewPane.querySelectorAll('.mermaid')
        });
    }

    // Debounce rendering (wait 300ms after typing stops)
    editor.on("change", () => {
        clearTimeout(timer);
        timer = setTimeout(render, 300);
    });

    // Initial Render
    render();

    // 3. Drag and Drop Image Handling
    const editorElement = document.querySelector('.CodeMirror');
    
    editorElement.addEventListener('dragover', (e) => {
        e.preventDefault();
        e.stopPropagation();
    });

    editorElement.addEventListener('drop', (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            const file = files[0];
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const base64 = event.target.result;
                    const doc = editor.getDoc();
                    const cursor = doc.getCursor();
                    const imageMarkdown = `![${file.name}](${base64})\n`;
                    doc.replaceRange(imageMarkdown, cursor);
                };
                reader.readAsDataURL(file);
            }
        }
    });

    // 4. Export Functionality
    function exportHtml() {
        // We clone the preview pane to get the computed HTML (including SVGs generated by Mermaid and HTML generated by KaTeX)
        const content = previewPane.innerHTML;

        // We need to include the CSS for KaTeX, Highlight.js, and basic Markdown styling
        // so the file looks good offline without JS.
        const htmlTemplate = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exported Markdown</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #24292e;
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
        }
        img { max-width: 100%; }
        table { border-collapse: collapse; width: 100%; margin: 1rem 0; }
        th, td { border: 1px solid #dfe2e5; padding: 6px 13px; }
        tr:nth-child(2n) { background-color: #f6f8fa; }
        pre { background-color: #f6f8fa; padding: 16px; border-radius: 6px; overflow: auto; }
        blockquote { border-left: 4px solid #dfe2e5; color: #6a737d; padding-left: 1em; margin-left: 0; }
        /* Ensure Mermaid SVGs are centered and responsive */
        .mermaid { display: flex; justify-content: center; margin: 2rem 0; }
        svg { max-width: 100%; height: auto; }
    </style>
</head>
<body>
    ${content}
</body>
</html>`;

        const blob = new Blob([htmlTemplate], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'document.html';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
</script>



</body></html>